"use strict";(self.webpackChunkbabylonjs=self.webpackChunkbabylonjs||[]).push([[996],{9996:(e,t,i)=>{i.r(t),i.d(t,{initScene:()=>o});var n=i(73),s=i(9848);i(9520),i(8232);class a extends n.AbstractMesh{constructor(e,t,i,n){super("player-wrapper"),this._movingForward=!1,this._movingBack=!1,this._movingLeft=!1,this._movingRight=!1,this._characterHeight=1.8,this._isRunning=!1,this._walkSpeed=10,this._runSpeed=25,this._camera=e,this._playerMesh=t,this._splatters=i,this._scene=n,this._playerWrapper=this,this._playerMesh.setParent(this._playerWrapper),this._playerMesh.isVisible=!1,this._camera.parent=this._playerMesh,this._camera.position.y=this._characterHeight,this._listenEvents(),this._calculateMovement(),this._calculateShoot()}async loadWeapon(){const{meshes:e}=await n.SceneLoader.ImportMeshAsync("","./models/","paintball_gun.glb");this._weapon=e[0],this._weapon.setParent(this._camera),this._weapon.position=new n.Vector3(.87,-.54,1.25)}_calculateShoot(){this._scene.onPointerDown=e=>{if(2===e.inputIndex){const e=this._camera.getForwardRay(void 0,void 0,this._playerWrapper.getAbsolutePosition().add(new n.Vector3(0,this._characterHeight,0))),t=this._scene.pickWithRay(e);if(t.hit){const e=(0,n.CreateDecal)("decal",t.pickedMesh,{position:t.pickedPoint,normal:t.getNormal(!0),size:new n.Vector3(1,1,1)});e.material=this._splatters[Math.floor(Math.random()*this._splatters.length)],e.setParent(t.pickedMesh)}}}}_calculateMovement(){this._scene.registerBeforeRender((()=>{const e=this._scene.getEngine().getDeltaTime()/1e3,t=this._camera.getDirection(n.Vector3.Forward()).normalizeToNew(),i=this._isRunning?this._runSpeed:this._walkSpeed;this._movingForward&&this._playerWrapper.moveWithCollisions(t.scale(i*e)),this._movingBack&&this._playerWrapper.moveWithCollisions(t.scale(.6*-i*e)),this._movingLeft&&this._playerWrapper.moveWithCollisions(t.cross(n.Axis.Y).scale(i*e)),this._movingRight&&this._playerWrapper.moveWithCollisions(t.cross(n.Axis.Y).scale(-i*e)),this._playerWrapper.position.y=this._characterHeight/2+.2}))}_listenEvents(){const e=this._scene.getEngine().getRenderingCanvas();e.addEventListener("keydown",(e=>{switch(e.code){case"KeyW":this._movingForward=!0;break;case"KeyS":this._movingBack=!0;break;case"KeyA":this._movingLeft=!0;break;case"KeyD":this._movingRight=!0;break;case"ShiftLeft":this._isRunning=!0,this._weapon.rotate(n.Axis.X,Math.PI/4)}})),e.addEventListener("keyup",(e=>{switch(e.code){case"KeyW":this._movingForward=!1;break;case"KeyS":this._movingBack=!1;break;case"KeyA":this._movingLeft=!1;break;case"KeyD":this._movingRight=!1;break;case"ShiftLeft":this._isRunning=!1,this._weapon.rotate(n.Axis.X,-Math.PI/4)}}))}}const r=a;async function o(e){e.getEngine().displayLoadingUI(),new n.HemisphericLight("light",new n.Vector3(0,1,0),e).intensity=.7;const t=function(e){const t=new n.UniversalCamera("camera",new n.Vector3(0,8,0),e);return t.attachControl(),t}(e),i=(new n.ArcRotateCamera("camera",Math.PI,Math.PI/4,20,n.Vector3.Zero()),function(){const e=s.AdvancedDynamicTexture.CreateFullscreenUI("UI"),t="white",i=new s.Rectangle("xRect");i.width="20px",i.height="2px",i.color=t,e.addControl(i);const n=new s.Rectangle("yRect");n.width="2px",n.height="20px",n.color=t,e.addControl(n);const a=new s.Rectangle("dotBar");a.horizontalAlignment=s.Control.HORIZONTAL_ALIGNMENT_CENTER,a.verticalAlignment=s.Control.VERTICAL_ALIGNMENT_BOTTOM,a.top="-20px",a.width="200px",a.height="40px",a.background="grey",e.addControl(a);const r=new s.Rectangle("dotBarInner");return r.horizontalAlignment=s.Control.HORIZONTAL_ALIGNMENT_LEFT,r.verticalAlignment=s.Control.VERTICAL_ALIGNMENT_CENTER,r.width="100px",r.height="40px",r.background="green",a.addControl(r),{crosshair:{xRect:i,yRect:n},vectorComparator:{dotBarInner:r}}}());await async function(e){const{meshes:t}=await n.SceneLoader.ImportMeshAsync("","./models/","Prototype_Level.glb",e);t.forEach((e=>{e.checkCollisions=!0,"Ramp"===e.name&&(e.isVisible=!1,e.checkCollisions=!1)}))}(e);const a=function(){const e=new n.StandardMaterial("blue"),t=new n.StandardMaterial("orange"),i=new n.StandardMaterial("green");return e.diffuseTexture=new n.Texture("./textures/blue.png"),t.diffuseTexture=new n.Texture("./textures/orange.png"),i.diffuseTexture=new n.Texture("./textures/green.png"),e.diffuseTexture.hasAlpha=!0,t.diffuseTexture.hasAlpha=!0,i.diffuseTexture.hasAlpha=!0,e.zOffset=-1,t.zOffset=-1,i.zOffset=-1,e.roughness=1,t.roughness=1,i.roughness=1,[e,t,i]}(),o=(0,n.CreateBox)("player-mesh"),h=new r(t,o,a,e);await h.loadWeapon(),e.clearColor=new n.Color4(.75,.75,.9,1),e.collisionsEnabled=!0;const c=(0,n.CreateSphere)("sphere",{diameter:5},e);c.checkCollisions=!0,c.position=new n.Vector3(0,2.5,5),e.onBeforeRenderObservable.add((()=>{const e=function(e,t){const i=e.getDirection(n.Vector3.Forward()).normalizeToNew(),s=t.position.subtract(e.position).normalizeToNew();return n.Vector3.Dot(i,s)}(t,c);!function(e,t){let i="white";i=t>.9?"green":t>.5?"yellow":"red",e.xRect.color=e.yRect.color=i}(i.crosshair,e),i.vectorComparator.dotBarInner.width=`${Math.floor(100*(e+1))}px`})),window.addEventListener("keydown",(t=>{t.ctrlKey&&73===t.keyCode&&(e.debugLayer.isVisible()?e.debugLayer.hide():e.debugLayer.show())})),e.getEngine().hideLoadingUI()}}}]);
//# sourceMappingURL=996.bundle.js.map